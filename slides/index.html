<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Advanced NServiceBus Deployment - NSBCon NYC 2014</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/serif.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

        <style>
            .reveal h5 {font-size: .6em;}
            .reveal h6 {font-size: .4em;}
        </style>

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<section>
                        <h1>Advanced NServiceBus Deployment</h1>
                        <br />
                        <h3>NSBCon NYC 2014</h3>
                        <p>
                            <small><a href="http://kijanawoodard.com">Kijana Woodard</a> / <a href="http://twitter.com/kijanawoodard">@kijanawoodard</a></small>
                        </p>
					</section>
<!--
                    <section id="transitions">
                        <h2>Transition Styles</h2>
                        <p>
                            You can select from different transitions, like: <br>
                            <a href="?transition=slide#/transitions">Slide</a> -
                            <a href="?transition=cube#/transitions">Cube</a> -
                            <a href="?transition=page#/transitions">Page</a> -
                            <a href="?transition=concave#/transitions">Concave</a> -
                            <a href="?transition=zoom#/transitions">Zoom</a> -
                            <a href="?transition=linear#/transitions">Linear</a> -
                            <a href="?transition=fade#/transitions">Fade</a> -
                            <a href="?transition=none#/transitions">None</a> -
                            <a href="?#/transitions">Default</a>
                        </p>
                    </section>

                    <section id="themes">
                        <h2>Themes</h2>
                        <p>
                            Reveal.js comes with a few themes built in: <br>
                            <a href="?#/themes">Default</a> -
                            <a href="?theme=sky#/themes">Sky</a> -
                            <a href="?theme=beige#/themes">Beige</a> -
                            <a href="?theme=simple#/themes">Simple</a> -
                            <a href="?theme=serif#/themes">Serif</a> -
                            <a href="?theme=night#/themes">Night</a> <br>
                            <a href="?theme=moon#/themes">Moon</a> -
                            <a href="?theme=solarized#/themes">Solarized</a>
                        </p>
                        <p>
                            <small>
                                * Theme demos are loaded after the presentation which leads to flicker. In production you should load your theme in the <code>&lt;head&gt;</code> using a <code>&lt;link&gt;</code>.
                            </small>
                        </p>
                    </section>-->
				</section>

                <section>
                    <section>
                        <h2>Background</h2>
                        <ul>
                            <li>Professional develop since 1996</li>
                            <li>.net since 1.0</li>
                            <li>Independent contractor since 2010</li>
                        </ul>

                        <aside class="notes">
                            for pay since 1996<br />
                            been lucky to find contracts with nservicebus and ravendb
                        </aside>
                    </section>

                    <section>
                        <h2>Around the web</h2>

                        <ul>
                            <li><a href="http://kijanawoodard.com">kijanawoodard.com</a></li>
                            <li><a href="https://twitter.com/kijanawoodard">twitter.com/kijanawoodard</a></li>
                            <li><a href="https://github.com/kijanawoodard">github.com/kijanawoodard</a></li>
                            <li><a href="https://www.linkedin.com/in/kijanawoodard">linkedin.com/in/kijanawoodard</a></li>
                            <li style="margin-top: 50px;"><a href="https://groups.google.com/forum/#!forum/particularsoftware">particular forum</a></li>
                            <li><a href="https://groups.google.com/forum/#!forum/ravendb">ravendb forum</a></li>
                            <li><a href="https://groups.google.com/forum/#!forum/dddcqrs">ddd/cqrs forum</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Slides are on GitHub</h2>

                        <ul>
                            <li>
                                <a href="https://github.com/kijanawoodard/NSBCon-NYC-2014/">github.com/kijanawoodard/NSBCon-NYC-2014/</a>
                            </li>
                        </ul>
                    </section>
                </section>
                <section>
                    <h1>Mitigation</h1>
                    <h2>all</h2>
                    <h3>the</h3>
                    <h4>way</h4>
                    <h5>down</h5>
                </section>
                <section>
                    <section>
                        <h2>Big Ball of Mud</h2>
                        Our journey begins
                        <aside class="notes">
                            understand the problem space<br />
                            the cure has to be better than the disease<br />
                            too often people iterate to a solution that is worse than the original problem<br />
                        </aside>
                    </section>
                    <section>
                        <h2>BBOM Architecure</h2>
                        <figure>
                            <img src="img/DependencyGraph.png" />
                            <figcaption>
                                -
                                <a href="http://thedailywtf.com/">
                                    thedailywtf.com
                                </a>
                                <cite>
                                    <a href="http://thedailywtf.com/Comments/The-Enterprise-Dependency.aspx">
                                        Comment On The Enterprise Dependency
                                    </a>
                                </cite>
                            </figcaption>
                        </figure>


                    </section>

                    <section>
                        <h2>BBOM Implementation</h2>

                        <pre><code data-trim class="cs" style="max-height: inherit;">
public class OrderController
{
    ...

    public OrderController(
        IOrderRepository orders,
        IBillingService billing,
        IShippingService shipping)
    {
        _orders = orders;
        _billing = billing;
        _shipping = shipping;
    }

    public HttpStatusCode Post(Order order)
    {
        _orders.Save(order.OrderDetails);
        _billing.Charge(order.BillingDetails);
        _shipping.Ship(order.ShippingDetails);

        return HttpStatusCode.OK;
    }
}
                        </code></pre>

                        <aside class="notes">
                            IoC / DI as a code smell<br />
                            this code hides the complexity<br />
                            error handling?<br/>
                            do what? log?<br />
                            effectively ORCHESTRATING the order process<br />
                            and the billing service depends on order repository to update order status<br />
                            and the customer service depends on the shipping service to grant free shipping for high value customers<br />
                            violates OCP - bbom takes shape
                        </aside>
                    </section>

                    <section>
                        <h2>Compensations</h2>

                        <ul>
                            <li class="fragment">Change control committee</li>
                            <li class="fragment">Source control committee</li>
                        </ul>

                        <aside class="notes">
                            worked at a company that required 17 signatures to deploy anything<br />
                            the worst is if someone takes that seriously - bottleneck<br />
                            everyone must get approval from SCM committee before _committing_ code<br />
                        </aside>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Mediator</h2>

                        <ul>
                            <li>
                                <a href="http://kijanawoodard.com/introducing-nimbus">kijanawoodard.com/introducing-nimbus</a>
                            </li>
                            <li>
                                <a href="http://lostechies.com/jimmybogard/2014/09/09/tackling-cross-cutting-concerns-with-a-mediator-pipeline/">lostechies.com/jimmybogard/2014/09/09/tackling-cross-cutting-concerns-with-a-mediator-pipeline/</a>
                            </li>
                        </ul>

                        <aside class="notes">
                            this talk is not about the mediator pattern<br />
                            but NSB will act as our mediator<br />
                        </aside>
                    </section>
                    <section>
                        <h2>Decouple through Events</h2>
                    </section>
                    <section>
                        <h2>Events Implementation</h2>

                        <pre><code data-trim class="cs" style="max-height: inherit;">
public class OrderController
{
    public IBus Bus { get; set; }

    public HttpStatusCode Post(ProcessOrder order)
    {
        Bus.Send(order);
        return HttpStatusCode.OK;
    }
}

...

public class OrderHandler
    : IHandleMessages&lt;ProcessOrder>
{
    public IBus Bus { get; set; }

    public void Handle(ProcessOrder message)
    {
        //save order...
        Bus.Publish&lt;IOrderAccepted>(x => x.Id = message.Id);
    }
}
                        </code></pre>

                        <aside class="notes">
                            IoC / DI as a code smell<br />
                            this code hides the complexity<br />
                            error handling?<br/>
                            do what? log?<br />
                            effectively orchestrating the order process<br />
                            and the billing service depends on order repository to update order status<br />
                            and the customer service depends on the shipping service to grant free shipping for high value customers<br />
                            violates OCP - bbom takes shape
                        </aside>
                    </section>
                    <section>
                        <h2>Why Events?</h2>
                        <ul>
                            <li>Single Responsibility</li>
                            <li>Open Closed Principle</li>
                            <li>ISP</li>
                            <li>DIP</li>
                            <li>Encapsulation</li>
                        </ul>

                        <aside class="notes">
                            twist your mind to see Liskov<br />
                        </aside>
                    </section>
                    <section>
                        <h2>It's almost as if...</h2>

                        <figure>
                            <blockquote cite="http://userpage.fu-berlin.de/~ram/pub/pub_jf47ht81Ht/doc_kay_oop_en">
                                OOP to me means only messaging,
                                local retention and protection and hiding of state-process,
                                and extreme late-binding of all things.
                            </blockquote>
                            <figcaption>Alan Kay - 2003</figcaption>
                        </figure>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>What's the problem?</h2>
                    </section>
                    <section>
                        <h2>BBOM Solution</h2>
                        <figure>
                            <img src="img/bbom.solution.png" />
                        </figure>
                    </section>
                    <section>
                        <h2>Events Solution</h2>
                        <figure>
                            <img src="img/events.solution.png" />
                        </figure>
                    </section>
                    <section>
                        <h2>Friction</h2>

                        <ul>
                            <li>
                                More moving parts
                                <ul>
                                    <li>Endpoints</li>
                                    <li>Message Conventions</li>
                                    <li>Serialization Format</li>
                                </ul>
                            </li>

                            <li>Harder to deploy</li>
                            <li>Decreased Legibility</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Combat Friction</h2>

                        <ul>
                            <li>Nuget packages?</li>
                            <li>Custom project templates?</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Automate Automate Automate</h2>

                        Won’t it be difficult to deploy?
                        Can be as simple as powershell scripts
                        Won’t it be difficult to maintain?
                        Use conventions to make life easier
                        How do we know what’s going on?
                        Discuss platform tools

                    </section>
                    <section>
                        <h2>Payoff</h2>

                        What does this setup afford us?
                        OPS redeployment of endpoints
                        Visibility into deployed environment
                        Repeatability
                        Faster / Smaller iterations
                        Confidence


                    </section>
                    <section>
                        <h2>OPS control</h2>
                    </section>
                    <section>
                        <h2>Service Insight</h2>

                        Further automation
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Bus Stop</h2>
                        <h3><a href="https://github.com/andreasohlund/BusStop">github.com/andreasohlund/BusStop</a></h3>
                        <figure>
                            <img src="img/bus.stop.solution.png" />
                        </figure>

                        <aside class="notes">
                            Project structure<br />
                            Internal Messages vs Contracts [Events]
                        </aside>
                    </section>
                    <section>
                        <h2>Bus Stop</h2>
                        <h3><a href="https://github.com/andreasohlund/BusStop">github.com/andreasohlund/BusStop</a></h3>
                        <pre><code data-trim class="cs" style="max-height: inherit;">
namespace BusStop.Config
{
    public static class MyConvention
    {
        public static Configure MyMessageConventions(this Configure config)
        {
            config.DefiningEventsAs(t => t.Namespace != null &&
                                         t.Namespace.EndsWith(".Contracts"));
            return config;
        }
    }
}
                        </code></pre>
                        <aside class="notes">
                            What else can we do with this technique?<br />
                            RUN events solution<br />
                        </aside>
                    </section>
                    <section>
                        <h2>Separate Endpoints from Handlers</h2>

                        Create an endpoint project and reuse for handlers
                        Creating endpoints becomes a deployment concern
                        Show code sample
                        Create an endpoint for development
                        How granular?

                    </section>
                </section>

                <section>
                    <section>
                        <h2>What about Commands?</h2>

                        The normal way – through a web endpoint
                        If you put the command on the bus?
                        Async issues in the ui
                        If you put the command handler in the web project?
                        Have to duplicate in an endpoint for direct access
                        More projects

                    </section>
                    <section>
                        <h2>What if you proxy?</h2>
                        Proxy the web requests to rest handlers in the endpoints
                        Downside?
                        Latency + fallacies of distributed computing
                        Are the downsides worth it?
                        Discuss
                        Show Code

                    </section>
                </section>
                <section>
                    <section>
                        <h2>Future exploration</h2>
                    </section>

                    <section>
                        <h2>What about queries?</h2>
                        Could proxy work again?
                        Could ANI help?

                    </section>
                </section>
                <section>
                    <section>
                        <h1>THE END</h1>
                    </section>

                    <section>
                        <h2>Advanced NServiceBus Deployment</h2>
                        <h3>Questions?</h3>

                        <ul>
                            <li><a href="https://github.com/kijanawoodard/NSBCon-NYC-2014/">slides @ github.com/kijanawoodard/NSBCon-NYC-2014/</a></li>
                            <li><a href="http://kijanawoodard.com">kijanawoodard.com</a></li>
                            <li><a href="https://twitter.com/kijanawoodard">twitter.com/kijanawoodard</a></li>

                            <li><a href="http://www.ribbonfarm.com/2010/07/26/a-big-little-idea-called-legibility/">ribbonfarm.com/2010/07/26/a-big-little-idea-called-legibility/</a></li>
                            <li><a href="http://userpage.fu-berlin.de/~ram/pub/pub_jf47ht81Ht/doc_kay_oop_en">Alan Kay on OO</a></li>
                            <li><a href="https://github.com/andreasohlund/BusStop">github.com/andreasohlund/BusStop</a></li>
                        </ul>
                    </section>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                backgroundTransition: 'slide',
				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
